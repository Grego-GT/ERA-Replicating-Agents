# Use official Deno image
FROM denoland/deno:1.45.5

# Set working directory
WORKDIR /app

# Copy all necessary files
COPY web ./web
COPY cli.ts ./cli.ts
COPY history.ts ./history.ts
COPY main.ts ./main.ts
COPY deno.json ./deno.json

# Copy core directories
COPY core ./core
COPY utils ./utils

# Copy demo agents (will be used to populate volume on first run)
COPY demo_agents ./demo_agents

# Create empty directories that might be needed
RUN mkdir -p /app/daytona
RUN mkdir -p /app/agents

# Set working directory to web
WORKDIR /app/web

# Copy and make entrypoint script executable
COPY web/entrypoint.sh /app/entrypoint.sh
RUN chmod +x /app/entrypoint.sh

# Cache dependencies
RUN deno cache server.ts ../cli.ts

# Expose port
EXPOSE 8080

# Use entrypoint script
ENTRYPOINT ["/app/entrypoint.sh"]

